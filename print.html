<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>The Quantinomocon</title>
                <meta name="robots" content="noindex" />
                

        <!-- Custom HTML head -->
        

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

                <link rel="icon" href="favicon.svg">
                        <link rel="shortcut icon" href="favicon.png">
                <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
                <link rel="stylesheet" href="css/print.css" media="print">
        
        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
                <link rel="stylesheet" href="fonts/fonts.css">
        
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
                <link rel="stylesheet" href="theme/nomicon.css">
        
            </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="intro.html">Introduction</a></li><li class="chapter-item expanded affix "><div>Setting Up Your Dev Environment</div></li><li class="chapter-item expanded "><a href="quantum-programming/overview.html"><strong aria-hidden="true">1.</strong> What is Quantum Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">1.1.</strong> Circuits and Pseudocode</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.2.</strong> Programming and Metaprogramming</div></li></ol></li><li class="chapter-item expanded "><a href="qkaledioscope/overview.html"><strong aria-hidden="true">2.</strong> Quantum Kaledioscope: Your Own Quantum Language</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="qkaledioscope/parsing.html"><strong aria-hidden="true">2.1.</strong> Parsing with pest.rs</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.2.</strong> Making Nice Errors</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.3.</strong> Building an AST</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">2.4.</strong> Working with Quantum Simulators</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.</strong> Using Quantum Kaledioscope from Other Languages</div></li><li><ol class="section"><li class="chapter-item expanded "><div><strong aria-hidden="true">3.1.</strong> Interoperating with Python Using PyO3</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">3.2.</strong> Interoperating with Julia Using a C API</div></li></ol></li><li class="chapter-item expanded "><div><strong aria-hidden="true">4.</strong> Compiling Quantum Programs</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">5.</strong> Running on Hardware</div></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="misc/contributors.html">Contributors</a></li></ol>            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                                                <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                                            </div>

                    <h1 class="menu-title">The Quantinomocon</h1>

                    <div class="right-buttons">
                                                <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                                                                        
                    </div>
                </div>

                                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<div class="warning">
<p>This book and its companion code are wildly incomplete, and may change dramatically as the project progresses.</p>
</div>
<h2 id="what-is-this-book"><a class="header" href="#what-is-this-book">What is this book?</a></h2>
<p>In this book, we'll walk through some of the key elements of a quantum computing compiler stack, using Rust various Rust libraries to help us out along the way. Our tour of quantum compilation will necessarily be in terms of proof-of-concept examples, more than anything immediately practical, but the core ideas and techniques will apply to varying degrees for any quantum compilation workflow targeting quantum simulators or even hardware.</p>
<p>The companion code for this book is available at <a href="https://github.com/qrust-dev/quantinomocon">https://github.com/qrust-dev/quantinomocon</a>.</p>
<h2 id="who-is-this-book-for"><a class="header" href="#who-is-this-book-for">Who is this book for?</a></h2>
<p>This book is <strong>not</strong> for teaching quantum programming or quantum software developmentâ€” if you're interested in writing quantum programs as a user or a quantum developer, great! You likely don't need this book, and may find it somewhere on the line from intensely boring to mildly horrifying. If you want to read this book anyway, welcome aboard, and enjoy the mess!</p>
<p>On the other hand, if you're interested in learning more about what goes on behind the scenes of your favorite quantum language, making your own quantum language, or learning more about where you can extend quantum compilation stacks with your own ideas, insights, and techniques, we hope you'll get something out of this book.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="what-is-quantum-programming"><a class="header" href="#what-is-quantum-programming">What is Quantum Programming</a></h1>
<div style="break-before: page; page-break-before: always;"></div><h1 id="quantum-kaledioscope"><a class="header" href="#quantum-kaledioscope">Quantum Kaledioscope</a></h1>
<p>Following the example of the famous (infamous?) <a href="https://llvm.org/docs/tutorial/">LLVM Kaledioscope tutorial</a> and its many derivatives, in the next few chapters we'll walk through how to define your own quantum language, interpret and simulate quantum programs written in your new language, and the basics of how to compile quantum programs.</p>
<p>There's a lot of good quantum languages out there already (Q# being a particular favorite), so our Quantum Kaledioscope (let's call it QK for short) is not really going to wind up being practical on its own, but hopefully going through the steps needed to parse, interpret, and compile quantum programs will be helpful in understanding quantum compilation stacks more generally.</p>
<p>Throughout the next few chapters, we'll be building up our Quantum Kaledioscope tooling as a Rust command-line tool. You can run and experiment with the tool by using <code>cargo</code>:</p>
<!-- TODO: It's more than a parser now, may want to move this folder. -->
<!-- TODO: Update as more subcommands are added. -->
<pre><code class="language-text">$ git clone https://github.com/qrust-dev/quantinomocon.git
$ cd quantinomocon/code/parser
$ cargo run -- --help
USAGE:
    parser.exe &lt;SUBCOMMAND&gt;

OPTIONS:
    -h, --help    Print help information

SUBCOMMANDS:
    build-ast    Parses a Quantum Kalediscope program and prints an abstract syntax tree for
                 the program
    help         Print this message or the help of the given subcommand(s)
    interpret    Interprets a Quantum Kalediscope program and runs it on a full-state quantum
                 simulator
    parse        Parses a Quantum Kalediscope program and prints the result
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="parsing-with-pestrs"><a class="header" href="#parsing-with-pestrs">Parsing with pest.rs</a></h1>
<h2 id="writing-the-parser"><a class="header" href="#writing-the-parser">Writing the parser</a></h2>
<!-- TODO: list lines in Cargo.toml for pest? -->
<p>Our first step in building a compiler for Quantum Kaledioscope will be to write a parser that takes raw text for a quantum program, and that outputs a data structure that we can work with in further compiler stages. To do so, we'll use the <a href="https://pest.rs/"><code>pest</code> crate</a>, as <code>pest</code> offers us a nice <em>macro</em> that we can use to greatly simplify writing quantum programs.</p>
<p>Indeed, using <code>pest</code>, our parser comes out to be very simple indeed:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Parser, Debug)]
#[grammar = &quot;qkaledioscope.pest&quot;]
pub struct QKaledioscopeParser;
<span class="boring">}
</span></code></pre></pre>
<p>Believe it or not, that's all the Rust code we need to write entire parser. The <code>#[derive(Parser)]</code> macro provided by <code>pest</code> takes care of all the hard work of writing a fast and robust parser in Rust for us; all we need to do at this point is specify the grammar, indicated by <code>qkaledioscope.pest</code>.</p>
<!-- TODO: settle I vs we here. -->
<p>OK, I lied: writing the parser isn't the first step. We need to decide what Quantum Kaledioscope even <em>is</em>, so that we can write the grammar we need to pass to <code>#[derive(Parser)]</code>! It's helpful to recall some of the basic elements we need in any quantum programming language, as we saw in <a href="qkaledioscope/../quantum-programming/overview.html">the chapter on quantum programming</a>:</p>
<ul>
<li>We need a way to call intrinsic quantum operations like <code>H</code> and <code>X</code>.</li>
<li>We need to be able to refer to individual qubits in our device.</li>
<li>We need to be able to measure qubits and extract classical data.</li>
<li>We need a way to represent flow control on classical data.</li>
</ul>
<p>In Quantum Kaledioscope, we'll provide these elements by modeling a quantum program as a sequence of one or more <em>functions</em>, each of which can call quantum gates defined as prototypes. For example, we might write a simple QRNG program in QK as:</p>
<pre><code class="language-text">extern h(q : qubit);
extern m(q : qubit) -&gt; bit;
extern print_b(b : bit);
extern pi() -&gt; number;

def foo() {
    var b: bit = true;
    var n: number = 3.14;
    var q: qubit = #3;
    var c: qubit = q;
}

def qmain() {
    h(#0);
    print_b(m(#0));
}

def print_b_twice(b : bit, q: qubit, n: number) {
    print_b(b);
    print_b(b);
}
</code></pre>
<p>Above, we've defined each gate that we have access to with an <code>extern</code> declaration, and have defined one function <code>qmain</code> by using the <code>def</code> keyword. That <code>qmain</code> function then refers to particular qubits (e.g.: <code>#0</code>) made available by our device, and passes those qubits to the various gates exposed by our simulator or device.</p>
<p>In our grammar, we may represent this by a sequence of <em>rules</em> that tell <code>pest</code> how to turn the various elements in our QK program above into data structures we can work with from Rust. For example, a program is a sequence of zero or more declarations and definitions, so we can write that out explicitly in our <code>pest</code> grammar:</p>
<pre><code class="language-text">program = _{ SOI ~ (file_element)* ~ EOI }

file_element = _{ (declaration | definition) }
declaration = { Extern ~ prototype ~ Semicolon }
definition = { Def ~ prototype ~ definition_body }
</code></pre>
<p>We'll need some additional rules to specify what text should be processed for <code>Extern</code>, <code>prototype</code>, and other symbols that we needed to use in our definition of the <code>program</code> rule. Generally, these rules are broken down into those rules that check against a string directly (terminal rules), and those that can recurse into other rules (non-terminal). By convention, we'll write out terminal rules in our grammar using <code>PascalCase</code> and non-terminals as <code>snake_case</code>.</p>
<!-- TODO: Describe if and while to connect to the fourth essential we need for quantum languages. -->
<p>For the full listing of the grammar for QK, check out <a href="https://github.com/qrust-dev/quantinomocon/blob/main/code/parser/src/qkaledioscope.pest">https://github.com/qrust-dev/quantinomocon/blob/main/code/parser/src/qkaledioscope.pest</a>.</p>
<h2 id="calling-into-the-parser"><a class="header" href="#calling-into-the-parser">Calling into the parser</a></h2>
<ul>
<li><input disabled="" type="checkbox"/>
Describe using <code>std::fs</code> to load a string.</li>
<li><input disabled="" type="checkbox"/>
The <code>Pair&lt;Rule&gt;</code> structure that comes back.</li>
<li><input disabled="" type="checkbox"/>
Using the <code>pretty-print</code> feature to turn to JSON and print.</li>
<li><input disabled="" type="checkbox"/>
Wrapping everything with <code>clap</code>.</li>
</ul>
<pre><code class="language-text">$ cargo run parse .\examples\qrng.qk
   Compiling parser v0.1.0
    Finished dev [unoptimized + debuginfo] target(s) in 2.28s
     Running `target\debug\parser.exe parse .\examples\qrng.qk`
{
  &quot;pos&quot;: [
    0,
    130
  ],
  &quot;pairs&quot;: [
    {
      &quot;pos&quot;: [
        0,
        20
      ],
      &quot;rule&quot;: &quot;declaration&quot;,
      &quot;inner&quot;: {
        &quot;pos&quot;: [
          7,
          19
        ],
        &quot;pairs&quot;: [
          {
            &quot;pos&quot;: [
              7,
              19
            ],
            &quot;rule&quot;: &quot;prototype&quot;,
            &quot;inner&quot;: {
              &quot;pos&quot;: [
                7,
                19
              ],
              &quot;pairs&quot;: [
                {
                  &quot;pos&quot;: [
                    7,
                    8
                  ],
                  &quot;rule&quot;: &quot;Ident&quot;,
                  &quot;inner&quot;: &quot;h&quot;
                  ...
</code></pre>
<div style="break-before: page; page-break-before: always;"></div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                        
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                            </nav>

        </div>

        
        
        
                <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        
        
                <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        
        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        
                        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
                
    </body>
</html>
